<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>雷神充电桩管理平台</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/site.css">
    <link rel="stylesheet" href="css/addchargepile.css">
    <style>
        .BMap_mask {
            background: transparent url(http://api0.map.bdimg.com/images/blank.gif);
        }
    </style>

</head>

<body>
<div class="content">
    <div class="top">
        <ul>
            <li><a href="index.html">首页</a><span>/</span></li>
            <li><a href="#">充电点管理</a></li>
        </ul>
    </div>
    <div class="bottom clearfix">
        <img src="images/edit.png" alt="">
        <h2>充电点管理</h2>
    </div>
    <div class="container-fluid">
        <div class="row-fluid" style="min-height: 600px">

            <div id="content" class="span10">


                <div class="row-fluid sortable ui-sortable">
                    <div class="box span12">
                        <div class="box-content">
                            <form class="form-horizontal" enctype="multipart/form-data" method="post">


                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">充电点图片</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input type="file" multiple class="file" id="file12" name="pic_path_list"/>(可上传多张)

                                        <div id="prev_file12">

                                        </div>
                                        <br/>
                                    </div>
                                </div>


                                <div class="control-group">
                                    <label class="control-label" for="focusedInput"><span style="color:red">*</span>充电点名称</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input required="yes"
                                               class="input-xlarge focused validate[funcCall[is_dup_name]]"
                                               maxlength="255" id="name"
                                               name="name" type="text"
                                               value="" onblur="this.value=this.value.trim()">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">充电点地区</label>

                                    <div class="controls">
                                        <select name="province" id="province" style="width:110px">
                                        </select>
                                        <select name="city" id="city" style="width:90px">
                                        </select>
                                        <select name="district" id="district" style="width:80px">
                                        </select>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput"><span style="color:red">*</span>充电点地址</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input required="yes" class="input-xlarge focused" maxlength="255" id="address"
                                               name="address" type="text" value=""
                                               onblur="this.value=this.value.trim()">
                                        <button type="button" class="btn btn-default" id="sub">搜索</button>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">价格区间</label>

                                    <div class="controls" style="padding-top: 5px;">

                                        <div style="padding-top: 5px;">
                                            <span>信息不明</span>
                                        </div>

                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">空闲个数</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input required="yes" class="input-xlarge focused" maxlength="255" id="idle_num"
                                               disabled="disabled" name="idle_num" type="text"
                                               value="0">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">慢充个数</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input required="yes" class="input-xlarge focused" maxlength="255" id="slow_num"
                                               disabled="disabled" name="slow_num" type="text"
                                               value="0">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">快充个数</label>

                                    <div class="controls" style="padding-top: 5px;">
                                        <input required="yes" class="input-xlarge focused" maxlength="255"
                                               id="quickly_num"
                                               disabled="disabled" name="quickly_num" type="text"
                                               value="0">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">纬度</label>

                                    <div class="controls">
                                        <input class="input-xlarge validate[funcCall[validate_lat_and_lng]]" readonly
                                               id="id_latitude" name="latitude" type="text"
                                               value="0">
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label class="control-label" for="focusedInput">经度</label>

                                    <div class="controls">
                                        <input class="input-xlarge focused validate[funcCall[validate_lat_and_lng]]" readonly="" id="id_longitude" name="longitude" type="text" value="0">
                                    </div>
                                </div>
                                <div class="control-group clearfix">
                                    <label class="control-label" for="selectError3"></label>

                                    <div class="controls" style="float: left;margin-left: 20px;">
                                        <div id="allmap"
                                             style="height: 400px; width: 900px; overflow: hidden; position: relative; z-index: 0; background-color: rgb(243, 241, 236); color: rgb(0, 0, 0); text-align: left;">
                                            <div style="overflow: visible; position: absolute; z-index: 0; left: 0px; top: 0px; cursor: url(&quot;http://api0.map.bdimg.com/images/openhand.cur&quot;) 8 8, default;">
                                                <div class="BMap_mask"
                                                     style="position: absolute; left: 0px; top: 0px; z-index: 9; overflow: hidden; user-select: none; width: 900px; height: 400px;"></div>
                                                <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 200;">
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 800;"></div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 700;">
                                                        <span class="BMap_Marker BMap_noprint" unselectable="on" "=""
                                                        style="position: absolute; padding: 0px; margin: 0px; border:
                                                        0px; cursor: pointer; background: url(&quot;http://api0.map.bdimg.com/images/blank.gif&quot;);
                                                        width: 18px; height: 18px; left: 222px; top: 236px; z-index:
                                                        19000000; user-select: none; display: none;" title=""></span>
                                                    </div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 600;"></div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 500;">
                                                        <label class="BMapLabel" unselectable="on"
                                                               style="position: absolute; display: none; cursor: inherit; background-color: rgb(190, 190, 190); border: 1px solid rgb(190, 190, 190); padding: 1px; white-space: nowrap; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 12px; line-height: normal; font-family: arial, sans-serif; z-index: -20000; color: rgb(190, 190, 190);">shadow</label><label
                                                            class="BMapLabel" unselectable="on"
                                                            style="position: absolute; display: none; cursor: inherit; background-color: rgb(255, 255, 225); border: 1px solid rgb(140, 140, 140); padding: 1px; white-space: nowrap; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 12px; line-height: normal; font-family: arial, sans-serif; z-index: 80; user-select: none; color: rgb(77, 77, 77);">点击可查看详情</label>
                                                    </div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 400;">
                                                        <span class="BMap_Marker" unselectable="on"
                                                              style="position: absolute; padding: 0px; margin: 0px; border: 0px; width: 0px; height: 0px; left: 222px; top: 236px; z-index: 19000000; display: none;"><div
                                                                style="position: absolute; margin: 0px; padding: 0px; width: 18px; height: 18px; overflow: hidden;">
                                                            <img src="http://api0.map.bdimg.com/images/spotmkrs.png"
                                                                 style="display: block; border:none;margin-left:-232px; margin-top:-208px; ">
                                                        </div></span></div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 300;"></div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 201;"></div>
                                                    <div style="position: absolute; height: 0px; width: 0px; left: 0px; top: 0px; z-index: 200;"></div>
                                                </div>
                                                <div style="position: absolute; overflow: visible; top: 0px; left: 0px; z-index: 1;">
                                                    <div style="position: absolute; overflow: visible; z-index: -100; left: 450px; top: 200px; display: block; transform: translate3d(0px, 0px, 0px);">
                                                        <img src="http://online1.map.bdimg.com/tile/?qt=tile&amp;x=6606&amp;y=1780&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                             style="position: absolute; border: none; width: 256px; height: 256px; left: -126px; top: -126px; max-width: none; opacity: 1;"><img
                                                            src="http://online0.map.bdimg.com/tile/?qt=tile&amp;x=6605&amp;y=1780&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -382px; top: -126px; max-width: none; opacity: 1;"><img
                                                            src="http://online2.map.bdimg.com/tile/?qt=tile&amp;x=6607&amp;y=1780&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 130px; top: -126px; max-width: none; opacity: 1;"><img
                                                            src="http://online0.map.bdimg.com/tile/?qt=tile&amp;x=6606&amp;y=1779&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -126px; top: 130px; max-width: none; opacity: 1;"><img
                                                            src="http://online2.map.bdimg.com/tile/?qt=tile&amp;x=6606&amp;y=1781&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -126px; top: -382px; max-width: none; opacity: 1;"><img
                                                            src="http://online3.map.bdimg.com/tile/?qt=tile&amp;x=6608&amp;y=1780&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 386px; top: -126px; max-width: none; opacity: 1;"><img
                                                            src="http://online4.map.bdimg.com/tile/?qt=tile&amp;x=6604&amp;y=1780&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -638px; top: -126px; max-width: none; opacity: 1;"><img
                                                            src="http://online4.map.bdimg.com/tile/?qt=tile&amp;x=6605&amp;y=1779&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -382px; top: 130px; max-width: none; opacity: 1;"><img
                                                            src="http://online1.map.bdimg.com/tile/?qt=tile&amp;x=6607&amp;y=1779&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 130px; top: 130px; max-width: none; opacity: 1;"><img
                                                            src="http://online1.map.bdimg.com/tile/?qt=tile&amp;x=6605&amp;y=1781&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -382px; top: -382px; max-width: none; opacity: 1;"><img
                                                            src="http://online3.map.bdimg.com/tile/?qt=tile&amp;x=6607&amp;y=1781&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 130px; top: -382px; max-width: none; opacity: 1;"><img
                                                            src="http://online3.map.bdimg.com/tile/?qt=tile&amp;x=6604&amp;y=1779&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -638px; top: 130px; max-width: none; opacity: 1;"><img
                                                            src="http://online2.map.bdimg.com/tile/?qt=tile&amp;x=6608&amp;y=1779&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 386px; top: 130px; max-width: none; opacity: 1;"><img
                                                            src="http://online0.map.bdimg.com/tile/?qt=tile&amp;x=6604&amp;y=1781&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: -638px; top: -382px; max-width: none; opacity: 1;"><img
                                                            src="http://online4.map.bdimg.com/tile/?qt=tile&amp;x=6608&amp;y=1781&amp;z=15&amp;styles=pl&amp;scaler=1&amp;udt=20161129"
                                                            style="position: absolute; border: none; width: 256px; height: 256px; left: 386px; top: -382px; max-width: none; opacity: 1;">
                                                    </div>
                                                </div>
                                                <div style="position: absolute; overflow: visible; top: 0px; left: 0px; z-index: 2; display: none;">
                                                    <div style="position: absolute; overflow: visible; top: 0px; left: 0px; z-index: 0; display: none;"></div>
                                                    <div style="position: absolute; overflow: visible; top: 0px; left: 0px; z-index: 10; display: none;"></div>
                                                </div>
                                                <div style="position: absolute; overflow: visible; top: 0px; left: 0px; z-index: 3;"></div>
                                            </div>
                                            <div class="pano_close" title="退出全景"
                                                 style="z-index: 1201; display: none;"></div>
                                            <a class="pano_pc_indoor_exit" title="退出室内景"
                                               style="z-index: 1201; display: none;"><span
                                                    style="float:right;margin-right:12px;">出口</span></a>
                                            <div class=" anchorBL"
                                                 style="height: 32px; position: absolute; z-index: 30; text-size-adjust: none; bottom: 0px; right: auto; top: auto; left: 1px;">
                                                <a title="到百度地图查看此区域" target="_blank" href="http://map.baidu.com/?sr=1"
                                                   style="outline: none;"><img
                                                        style="border:none;width:77px;height:32px"
                                                        src="http://api0.map.bdimg.com/images/copyright_logo.png"></a>
                                            </div>
                                            <div id="zoomer"
                                                 style="position:absolute;z-index:0;top:0px;left:0px;overflow:hidden;visibility:hidden;cursor:url(http://api0.map.bdimg.com/images/openhand.cur) 8 8,default">
                                                <div class="BMap_zoomer" style="top:0;left:0;"></div>
                                                <div class="BMap_zoomer" style="top:0;right:0;"></div>
                                                <div class="BMap_zoomer" style="bottom:0;left:0;"></div>
                                                <div class="BMap_zoomer" style="bottom:0;right:0;"></div>
                                            </div>
                                            <div unselectable="on" class=" BMap_cpyCtrl BMap_noprint anchorBL"
                                                 style="cursor: default; white-space: nowrap; color: black; background: none; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 11px; line-height: 15px; font-family: arial, sans-serif; bottom: 2px; right: auto; top: auto; left: 81px; position: absolute; z-index: 10; text-size-adjust: none;">
                                                <span _cid="1" style="display: inline;"><span style="font-size:11px">© 2016 Baidu&nbsp;- Data © <a
                                                        target="_blank" href="http://www.navinfo.com/"
                                                        style="display:inline;">NavInfo</a> &amp; <a target="_blank"
                                                                                                     href="http://www.cennavi.com.cn/"
                                                                                                     style="display:inline;">CenNavi</a> &amp; <a
                                                        target="_blank" href="http://www.365ditu.com/"
                                                        style="display:inline;">道道通</a></span></span></div>
                                        </div>


                                    </div>
                                </div>



                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">保存</button>
                                </div>

                            </form>

                        </div>
                    </div>
                </div>

            </div>
            <!--/#content.span10-->
        </div>
        <!--/fluid-row-->

        <hr>
        <footer>
            <p class="pull-left">&copy; <a href="#" target="_blank">版权所有</a> 2016</p>

            <p class="pull-right">Powered by: 咔酷咔新能源</p>
        </footer>

    </div>
</div>
<script>
    $(function () {
        $('.file').preimage();
    })
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var elements = document.getElementsByTagName("input");
        for (var i = 0; i < elements.length; i++) {
            elements[i].oninvalid = function (e) {
                e.target.setCustomValidity("");
                if (!e.target.validity.valid) {
                    e.target.setCustomValidity("必填字段，不能为空！");
                }
            };
            elements[i].oninput = function (e) {
                e.target.setCustomValidity("");
            };
        }

        var select_elements = document.getElementsByTagName("select");
        for (var i = 0; i < select_elements.length; i++) {
            select_elements[i].oninvalid = function (e) {
                e.target.setCustomValidity("");
                if (!e.target.validity.valid) {
                    e.target.setCustomValidity("必须选择一项！");
                }
            };
            select_elements[i].oninput = function (e) {
                e.target.setCustomValidity("");
            };
        }

    })
    $(function () {
        function paginate_init() {
            var number_page = $(".footer-page").find('.number-page');
            var page_no = parseInt("1");
            var next_show = page_no + 9;
            var prev_hide = page_no - 9;
            number_page.each(function (i, n) {
                var this_text = parseInt($(this).text());
                if (this_text >= page_no && this_text <= next_show) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
                if (this_text >= prev_hide && this_text <= next_show) {
                    $(this).show();
                }
            });
        }

        paginate_init();
        $(".number-page").bind('click', function () {
            var this_value = $(this).text();
            return pagination(this_value);
        });
        var prev = $(".prev");
        var next = $(".next");
        var home_page = $(".home_page");
        var last_page = $(".last_page");
        var page_no = parseInt('1');
        var page_total = parseInt('');
        if (page_no == 1) {
            prev.unbind('click');
        }
        home_page.bind('click', function () {
            return pagination(1);
        });
        last_page.bind('click', function () {
            return pagination(page_total);
        });
        prev.bind('click', function () {
            if (page_no > 1) {
                page_no = parseInt(page_no) - 1;
                return pagination(page_no);
            }
            return false;
        });
        next.bind('click', function () {
            if (page_no < page_total) {
                page_no = page_no + 1;
                return pagination(page_no);
            }
            return false;
        });

        $("#btnPageSubmit").click(function () {
            var page = $("#pageNumber").val();
            return pagination(page);
        })

        $(".category_allocation").bind('click', function () {
            var selected_picture = $(".download_show");
            var len = selected_picture.length;
            if (len != 0) {
                var p = picture_id_list(selected_picture);
                //var l = p.split(',').length;
                if (confirm('确定要把选中的' + len + '张图片移到此分类。？')) {
                    var target_category_id = $(this).attr('data-value');
                    var picture_id = '';
                    // 得到选中的所有图片id
                    if (p) {
                        window.location = '/custom/admin/category/allocation/' + target_category_id + "?picture_id=" + p + "&original_category_id=&category_name=&current_location=充电点管理&menu_no=None&page_no=1&search_source_site=";
                    }
                }
            } else {
                alert('请选择至少一张图片!');
            }

        });
        function picture_id_list(selected_picture) {
            // var response_picture_id = ',';
            var picture_id = '';
            selected_picture.each(function () {
                picture_id += $(this).attr('data-value') + ','
            });
            var p = picture_id.substring(0, picture_id.length - 1);
            //response_picture_id = response_picture_id.substring(0, response_picture_id.length -1);
            //response_picture_id += p;
            return p;
        }

        function pagination(page_no) {
            var current_url = window.location.href;
            var is_exist = false;
            var has_para = (current_url.indexOf('?') == -1) ? false : true
            var para_index = -1;
            if (has_para) {
                if ((para_index = current_url.indexOf('&page_no')) != -1 ||
                        (para_index = current_url.indexOf('?page_no')) != -1) {
                    is_exist = true
                }
            }
            if (is_exist) {
                var url_last_str = current_url.substring(para_index, current_url.length);
                var page_no_str = ''
                if (url_last_str.indexOf('&page_no') != -1) {
                    page_no_str = url_last_str.split('&')[1];
                } else if (url_last_str.indexOf('?page_no') != -1) {
                    page_no_str = url_last_str.split('?')[1];
                }
                window.location.href = current_url.replace(page_no_str, 'page_no=' + page_no);
            } else {
                if (has_para) {
                    window.location.href = current_url + '&page_no=' + page_no;
                } else {
                    window.location.href = current_url + '?page_no=' + page_no;
                }

            }
            return true;
        }
    })
</script>

<script src="/static/js/custom_admin/jquery.validationEngine-zh_CN.js"></script>
<script src="/static/js/custom_admin/jquery.validationEngine.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=fWqmse9vFRT5con3hLAPysWp"></script>
<!--<script type="text/javascript" src="/static/js/custom_admin/map.js"></script>-->
<!--<script type="text/javascript" src="/static/js/custom_admin/jsAddress.js"></script>-->
<script>
    var has_duplicate_name = false
    var old_name = $('#name').val()
    $(function () {
        $('form').validationEngine()

        addressInit('province', 'city', 'district', '省', '市', '区');


        $('#merchant').change(function () {
            var merchant_id = $(this).val()
            $('#merchant_id').val(merchant_id)
        })

        $('.delete_image').click(function () {
            var image_obj = $(this).parent()
            var image_id = $(this).attr('data-image')
            $.post('/custom/admin/charger/area/image/delete/', {'img_id': image_id}, function (data) {
                if (data.result) {
                    image_obj.hide()
                }
            })
        })

        $('#name').blur(function () {
            var name = $("#name").val();
            if (name != old_name) {
                $.post("/custom/admin/charger/area/name/addr/validate/", {'name': name}, function (data) {
                    if (!data.result) {
                        has_duplicate_name = true
                    } else {
                        has_duplicate_name = false
                    }
                });
            }
        })
    })

    function validate_lat_and_lng() {
        var lat = $('#id_latitude').val()
        var lng = $('#id_longitude').val()

        if (lat == 0 || lng == 0) {
            return '经纬度不能为0'
        }
    }

    function is_dup_name() {
        var name = $("#name").val()

        if (has_duplicate_name) {
            return '充电点名称已存在!'
        }
    }

</script>


</body>
</html>
